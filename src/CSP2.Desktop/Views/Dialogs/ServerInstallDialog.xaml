<Window x:Class="CSP2.Desktop.Views.Dialogs.ServerInstallDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="安装 CS2 服务器" 
        Height="600" 
        Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="{StaticResource BackgroundBrush}">
    
    <Grid Margin="40">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题区域 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,32">
            <Border Background="{StaticResource PrimaryPaleBrush}"
                    Width="80"
                    Height="80"
                    CornerRadius="40"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,24">
                <TextBlock Text="⬇️"
                           FontSize="40"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"/>
            </Border>
            
            <TextBlock Text="安装 CS2 服务器" 
                       FontSize="32" 
                       FontWeight="Bold"
                       Foreground="{StaticResource TextPrimaryBrush}"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="选择安装方式或使用现有安装" 
                       FontSize="16" 
                       Foreground="{StaticResource TextSecondaryBrush}"
                       HorizontalAlignment="Center"
                       Margin="0,12,0,0"/>
        </StackPanel>

        <!-- 主内容区域 -->
        <Grid Grid.Row="1" x:Name="ContentGrid">
            <!-- 步骤1：选择安装方式 -->
            <StackPanel x:Name="Step1Panel" Visibility="Visible">
                <TextBlock Text="请选择安装方式" 
                           FontSize="20" 
                           FontWeight="Bold"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           Margin="0,0,0,24"/>

                <!-- SteamCMD 下载 -->
                <Border Style="{StaticResource HoverCardStyle}"
                        Padding="24"
                        Margin="0,0,0,16"
                        MouseDown="SteamCmdOption_Click"
                        Tag="steamcmd">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0"
                                Background="{StaticResource PrimaryPaleBrush}"
                                Width="56"
                                Height="56"
                                CornerRadius="12"
                                Margin="0,0,20,0">
                            <TextBlock Text="📦"
                                       FontSize="28"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Center"/>
                        </Border>

                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="使用 SteamCMD 下载"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <TextBlock Text="自动下载最新的 CS2 服务器文件（约30GB）"
                                       FontSize="14"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,6,0,0"/>
                            <TextBlock Text="✅ 推荐 • 自动更新 • 独立管理"
                                       FontSize="12"
                                       Foreground="{StaticResource SuccessBrush}"
                                       Margin="0,8,0,0"/>
                        </StackPanel>

                        <TextBlock Grid.Column="2"
                                   Text="→"
                                   FontSize="32"
                                   Foreground="{StaticResource Gray400Brush}"
                                   VerticalAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- 使用现有安装 -->
                <Border Style="{StaticResource HoverCardStyle}"
                        Padding="24"
                        MouseDown="ExistingInstallOption_Click"
                        Tag="existing">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0"
                                Background="{StaticResource InfoLightBrush}"
                                Width="56"
                                Height="56"
                                CornerRadius="12"
                                Margin="0,0,20,0">
                            <TextBlock Text="📁"
                                       FontSize="28"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Center"/>
                        </Border>

                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="使用现有安装"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <TextBlock x:Name="DetectedInstallsText"
                                       Text="正在扫描..."
                                       FontSize="14"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,6,0,0"/>
                            <TextBlock Text="💡 节省空间 • 共享文件 • 快速启动"
                                       FontSize="12"
                                       Foreground="{StaticResource InfoBrush}"
                                       Margin="0,8,0,0"/>
                        </StackPanel>

                        <TextBlock Grid.Column="2"
                                   Text="→"
                                   FontSize="32"
                                   Foreground="{StaticResource Gray400Brush}"
                                   VerticalAlignment="Center"/>
                    </Grid>
                </Border>
            </StackPanel>

            <!-- 步骤2：配置服务器 -->
            <ScrollViewer x:Name="Step2Panel" Visibility="Collapsed" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <TextBlock Text="配置服务器信息" 
                               FontSize="20" 
                               FontWeight="Bold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               Margin="0,0,0,24"/>

                    <!-- 服务器名称 -->
                    <TextBlock Text="服务器名称" 
                               FontSize="14" 
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               Margin="0,0,0,8"/>
                    <TextBox x:Name="ServerNameTextBox"
                             Text="我的 CS2 服务器"
                             Style="{StaticResource ModernTextBox}"
                             Margin="0,0,0,20"/>

                    <!-- 安装路径（仅 SteamCMD） -->
                    <StackPanel x:Name="InstallPathPanel" Visibility="Collapsed">
                        <TextBlock Text="安装路径" 
                                   FontSize="14" 
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   Margin="0,0,0,8"/>
                        <Grid Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="InstallPathTextBox"
                                     Grid.Column="0"
                                     Style="{StaticResource ModernTextBox}"/>
                            <Button Grid.Column="1"
                                    Content="📁"
                                    Click="BrowseInstallPath_Click"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Margin="12,0,0,0"
                                    Width="40"
                                    Height="40"
                                    FontSize="16"/>
                        </Grid>
                        <TextBlock Text="服务器文件将下载到此目录" 
                                   FontSize="12" 
                                   Foreground="{StaticResource TextTertiaryBrush}"
                                   Margin="0,0,0,20"/>
                    </StackPanel>

                    <!-- 选择现有安装（仅现有安装） -->
                    <StackPanel x:Name="ExistingInstallPanel" Visibility="Collapsed">
                        <TextBlock Text="选择现有安装" 
                                   FontSize="14" 
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   Margin="0,0,0,8"/>
                        <ComboBox x:Name="ExistingInstallComboBox"
                                  Style="{StaticResource ModernComboBox}"
                                  Margin="0,0,0,20"/>
                    </StackPanel>

                    <!-- 网络配置 -->
                    <Border Background="{StaticResource SurfaceBrush}"
                            CornerRadius="10"
                            Padding="20"
                            Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="网络配置" 
                                       FontSize="16" 
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,16"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="12"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="IP地址" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,6"/>
                                    <TextBox x:Name="IpAddressTextBox"
                                             Text="0.0.0.0"
                                             Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="端口" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,6"/>
                                    <TextBox x:Name="PortTextBox"
                                             Text="27015"
                                             Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- 游戏配置 -->
                    <Border Background="{StaticResource SurfaceBrush}"
                            CornerRadius="10"
                            Padding="20">
                        <StackPanel>
                            <TextBlock Text="游戏配置" 
                                       FontSize="16" 
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       Margin="0,0,0,16"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="12"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="12"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <TextBlock Text="初始地图" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,6"/>
                                    <TextBox x:Name="MapTextBox"
                                             Text="de_dust2"
                                             Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="0" Grid.Column="2">
                                    <TextBlock Text="最大玩家" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,6"/>
                                    <TextBox x:Name="MaxPlayersTextBox"
                                             Text="10"
                                             Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="2" Grid.Column="0">
                                    <TextBlock Text="Tick Rate" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,6"/>
                                    <ComboBox x:Name="TickRateComboBox"
                                              Style="{StaticResource ModernComboBox}"
                                              SelectedIndex="1">
                                        <ComboBoxItem Content="64"/>
                                        <ComboBoxItem Content="128"/>
                                    </ComboBox>
                                </StackPanel>

                                <StackPanel Grid.Row="2" Grid.Column="2">
                                    <TextBlock Text="地图组" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,6"/>
                                    <TextBox x:Name="MapGroupTextBox"
                                             Text="mg_active"
                                             Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- 步骤3：安装进度 -->
            <StackPanel x:Name="Step3Panel" Visibility="Collapsed" VerticalAlignment="Center">
                <Border Background="{StaticResource PrimaryPaleBrush}"
                        Width="120"
                        Height="120"
                        CornerRadius="60"
                        HorizontalAlignment="Center"
                        Margin="0,0,0,32">
                    <TextBlock x:Name="ProgressIconTextBlock"
                               Text="⬇️"
                               FontSize="64"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"/>
                </Border>

                <TextBlock x:Name="ProgressTitleTextBlock"
                           Text="正在安装服务器..."
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           HorizontalAlignment="Center"/>
                
                <TextBlock x:Name="ProgressMessageTextBlock"
                           Text="正在准备..."
                           FontSize="16"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"
                           TextWrapping="Wrap"
                           Margin="0,12,0,32"
                           MaxWidth="500"/>

                <Border Background="{StaticResource SurfaceBrush}"
                        CornerRadius="12"
                        Padding="24"
                        MaxWidth="500">
                    <StackPanel>
                        <Grid Margin="0,0,0,12">
                            <TextBlock Text="{Binding ElementName=InstallProgressBar, Path=Value, StringFormat={}{0:F1}%}"
                                       FontSize="32"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource PrimaryBrush}"
                                       HorizontalAlignment="Center"/>
                        </Grid>

                        <ProgressBar x:Name="InstallProgressBar"
                                     Style="{StaticResource ModernProgressBar}"
                                     Height="12"
                                     Maximum="100"
                                     Value="0"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!-- 按钮区域 -->
        <Grid Grid.Row="2" Margin="0,32,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button x:Name="CancelButton"
                    Grid.Column="0"
                    Content="取消"
                    Click="CancelButton_Click"
                    Style="{StaticResource SecondaryButtonStyle}"
                    HorizontalAlignment="Left"
                    Padding="24,12"
                    Width="120"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button x:Name="BackButton"
                        Content="← 上一步"
                        Click="BackButton_Click"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Padding="24,12"
                        Width="140"
                        Visibility="Collapsed"/>

                <Button x:Name="NextButton"
                        Content="下一步 →"
                        Click="NextButton_Click"
                        Style="{StaticResource PrimaryButtonStyle}"
                        Padding="24,12"
                        Width="140"
                        Margin="12,0,0,0"
                        Visibility="Collapsed"/>

                <Button x:Name="InstallButton"
                        Content="✅ 开始安装"
                        Click="InstallButton_Click"
                        Style="{StaticResource SuccessButtonStyle}"
                        Padding="24,12"
                        Width="160"
                        Margin="12,0,0,0"
                        Visibility="Collapsed"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>

