# CSP2 开发路线图

> 详细的开发计划和任务分解

**更新时间**: 2025-10-25

---

## 🎯 开发目标

**MVP目标**: 在 **2-3周** 内完成一个可用的基础版本，包含：
- ✅ 服务器启动/停止管理
- ✅ 实时日志查看
- ✅ Metamod和CSS自动安装
- ✅ 基础插件管理

**V2目标**: 在MVP基础上，**4-6周** 内实现：
- 插件市场
- Linux支持（迁移到Avalonia）
- 更多框架支持

---

## 📅 开发阶段

### **Phase 0: 项目初始化（1-2天）**

#### 任务清单

- [x] 创建技术设计文档
- [x] 创建项目结构说明
- [ ] 创建开发路线图
- [ ] 创建WPF学习指南
- [ ] 创建GitHub仓库
- [ ] 初始化Git
- [ ] 创建Visual Studio解决方案
- [ ] 创建项目结构（Core、Providers、Desktop）
- [ ] 配置项目依赖
- [ ] 验证编译通过

#### 输出成果
- ✅ 完整的文档体系
- ✅ 可编译的项目骨架
- ✅ Git仓库初始化

---

### **Phase 1: 核心架构（3-4天）**

#### 1.1 定义核心接口（1天）

**任务**:
- [ ] 创建 `IPlatformProvider.cs`
- [ ] 创建 `IFrameworkProvider.cs`
- [ ] 创建 `IServerManager.cs`
- [ ] 创建 `IPluginManager.cs`
- [ ] 创建所有数据模型类

**文件清单**:
```
CSP2.Core/Abstractions/
  ├── IPlatformProvider.cs
  ├── IFrameworkProvider.cs
  ├── IServerManager.cs
  ├── IPluginManager.cs
  └── ISteamCmdService.cs

CSP2.Core/Models/
  ├── Server.cs
  ├── ServerConfig.cs
  ├── PluginInfo.cs
  ├── FrameworkInfo.cs
  └── ProviderMetadata.cs
```

**验收标准**:
- 所有接口编译通过
- 包含完整的XML注释
- 数据模型包含必要的属性

---

#### 1.2 实现Provider注册机制（1天）

**任务**:
- [ ] 实现 `ProviderRegistry.cs`
- [ ] 实现Provider自动发现和注册
- [ ] 实现依赖注入配置
- [ ] 编写单元测试

**文件清单**:
```
CSP2.Core/Services/
  └── ProviderRegistry.cs

CSP2.Core/Extensions/
  └── ServiceCollectionExtensions.cs

tests/CSP2.Core.Tests/
  └── ProviderRegistryTests.cs
```

**验收标准**:
- 可以注册和获取Provider
- 支持优先级排序
- 单元测试覆盖率>80%

---

#### 1.3 实现Windows平台Provider（1天）

**任务**:
- [ ] 实现 `WindowsPlatformProvider.cs`
- [ ] 实现进程管理 `WindowsServerProcess.cs`
- [ ] 实现系统信息获取
- [ ] 编写集成测试

**文件清单**:
```
CSP2.Providers/Platforms/Windows/
  ├── WindowsPlatformProvider.cs
  ├── WindowsServerProcess.cs
  └── WindowsSystemInfo.cs
```

**验收标准**:
- 可以启动和停止CS2进程
- 可以捕获标准输出
- 可以发送命令到进程

---

#### 1.4 实现ServerManager（1天）

**任务**:
- [ ] 实现 `ServerManager.cs`
- [ ] 实现服务器CRUD操作
- [ ] 实现日志事件机制
- [ ] 实现配置持久化

**文件清单**:
```
CSP2.Core/Services/
  ├── ServerManager.cs
  └── ConfigurationService.cs
```

**验收标准**:
- 可以添加、删除、启动、停止服务器
- 可以实时接收日志
- 配置可以保存到JSON文件

---

### **Phase 2: 基础UI（3-4天）**

#### 2.1 搭建WPF主框架（1天）

**任务**:
- [ ] 创建MainWindow主窗口
- [ ] 创建导航框架（左侧菜单）
- [ ] 配置MVVM依赖注入
- [ ] 创建基础样式资源

**文件清单**:
```
CSP2.Desktop/
  ├── App.xaml
  ├── App.xaml.cs
  ├── MainWindow.xaml
  ├── MainWindow.xaml.cs
  ├── ViewModels/MainWindowViewModel.cs
  └── Resources/Styles/
      ├── Colors.xaml
      └── ButtonStyles.xaml
```

**验收标准**:
- 窗口可以正常打开
- 左侧导航菜单可切换页面
- MVVM绑定正常工作

---

#### 2.2 实现服务器管理页面（1.5天）

**任务**:
- [ ] 创建ServerManagementPage视图
- [ ] 创建ServerManagementViewModel
- [ ] 实现服务器列表显示
- [ ] 实现添加服务器对话框
- [ ] 实现启动/停止按钮

**文件清单**:
```
CSP2.Desktop/Pages/
  ├── ServerManagementPage.xaml
  └── ServerManagementPage.xaml.cs

CSP2.Desktop/ViewModels/
  └── ServerManagementViewModel.cs

CSP2.Desktop/Dialogs/
  └── AddServerDialog.xaml
```

**界面设计**:
```
┌──────────────────────────────────────────────┐
│  CSP2 服务器管理面板                          │
├──────────────────────────────────────────────┤
│                                              │
│  [+ 添加服务器]                   [刷新]      │
│                                              │
│  ┌────────────────────────────────────────┐ │
│  │ 我的CS2服务器            ●运行中        │ │
│  │ 路径: C:\CS2Server                     │ │
│  │ 端口: 27015  地图: de_dust2             │ │
│  │                                        │ │
│  │ [停止] [重启] [查看日志] [设置]        │ │
│  └────────────────────────────────────────┘ │
│                                              │
│  ┌────────────────────────────────────────┐ │
│  │ 测试服务器              ○已停止         │ │
│  │ 路径: D:\TestServer                    │ │
│  │ 端口: 27016  地图: de_mirage            │ │
│  │                                        │ │
│  │ [启动] [设置] [删除]                   │ │
│  └────────────────────────────────────────┘ │
│                                              │
└──────────────────────────────────────────────┘
```

**验收标准**:
- 可以显示服务器列表
- 可以添加新服务器（选择路径）
- 可以启动/停止服务器
- 状态实时更新

---

#### 2.3 实现日志控制台页面（1天）

**任务**:
- [ ] 创建LogConsolePage视图
- [ ] 创建LogConsoleViewModel
- [ ] 实现日志实时显示
- [ ] 实现命令输入框
- [ ] 实现日志过滤和搜索

**文件清单**:
```
CSP2.Desktop/Pages/
  └── LogConsolePage.xaml

CSP2.Desktop/ViewModels/
  └── LogConsoleViewModel.cs

CSP2.Desktop/Controls/
  └── LogViewer.xaml
```

**界面设计**:
```
┌──────────────────────────────────────────────┐
│  日志控制台 - 我的CS2服务器                    │
├──────────────────────────────────────────────┤
│  [服务器: 我的CS2服务器 ▼]       [清空日志]   │
│                                              │
│  ┌────────────────────────────────────────┐ │
│  │ [12:30:15] Server started              │ │
│  │ [12:30:16] Loading map de_dust2...     │ │
│  │ [12:30:18] Map loaded successfully     │ │
│  │ [12:30:20] Player connected: PlayerA   │ │
│  │ [12:30:25] Round started               │ │
│  │ ...                                    │ │
│  │ ...                                    │ │
│  │ (自动滚动)                             │ │
│  └────────────────────────────────────────┘ │
│                                              │
│  输入命令: [mp_warmup_end            ] [发送]│
│                                              │
└──────────────────────────────────────────────┘
```

**验收标准**:
- 日志可以实时显示
- 可以切换查看不同服务器的日志
- 可以发送命令
- 支持自动滚动
- 支持颜色高亮（错误红色、警告黄色）

---

#### 2.4 实现设置页面（0.5天）

**任务**:
- [ ] 创建SettingsPage视图
- [ ] 创建SettingsViewModel
- [ ] 实现基础设置项

**文件清单**:
```
CSP2.Desktop/Pages/
  └── SettingsPage.xaml

CSP2.Desktop/ViewModels/
  └── SettingsViewModel.cs
```

**验收标准**:
- 可以设置主题（深色/浅色）
- 可以设置语言
- 设置可以保存

---

### **Phase 3: 框架管理（2-3天）**

#### 3.1 实现Metamod Provider（1天）

**任务**:
- [ ] 实现 `MetamodFrameworkProvider.cs`
- [ ] 实现自动下载和安装
- [ ] 实现版本检测
- [ ] 测试安装流程

**文件清单**:
```
CSP2.Providers/Frameworks/Metamod/
  ├── MetamodFrameworkProvider.cs
  └── MetamodInstaller.cs
```

**验收标准**:
- 可以检测是否已安装
- 可以从GitHub下载最新版本
- 可以自动解压到正确目录
- 可以获取已安装版本

---

#### 3.2 实现CounterStrikeSharp Provider（1天）

**任务**:
- [ ] 实现 `CSSFrameworkProvider.cs`
- [ ] 实现依赖检查（依赖Metamod）
- [ ] 实现插件扫描功能
- [ ] 测试安装流程

**文件清单**:
```
CSP2.Providers/Frameworks/CounterStrikeSharp/
  ├── CSSFrameworkProvider.cs
  ├── CSSPluginInstaller.cs
  └── CSSConfigManager.cs
```

**验收标准**:
- 安装前检查Metamod是否存在
- 可以安装CounterStrikeSharp
- 可以扫描已安装的CSS插件
- 可以安装/卸载CSS插件

---

#### 3.3 UI集成框架管理（1天）

**任务**:
- [ ] 在服务器设置中添加"框架管理"标签
- [ ] 显示已安装框架列表
- [ ] 实现一键安装Metamod
- [ ] 实现一键安装CSS
- [ ] 显示安装进度

**界面设计**:
```
┌──────────────────────────────────────────────┐
│  框架管理 - 我的CS2服务器                      │
├──────────────────────────────────────────────┤
│                                              │
│  ┌────────────────────────────────────────┐ │
│  │ Metamod:Source            ✓ 已安装     │ │
│  │ 版本: 2.0.0-dev                        │ │
│  │                                        │ │
│  │ [更新] [卸载]                          │ │
│  └────────────────────────────────────────┘ │
│                                              │
│  ┌────────────────────────────────────────┐ │
│  │ CounterStrikeSharp        ✓ 已安装     │ │
│  │ 版本: 1.0.0                            │ │
│  │ 依赖: Metamod ✓                        │ │
│  │                                        │ │
│  │ [更新] [卸载]                          │ │
│  └────────────────────────────────────────┘ │
│                                              │
│  ┌────────────────────────────────────────┐ │
│  │ SourceMod                 ○ 未安装     │ │
│  │ 描述: Valve官方插件框架                 │ │
│  │                                        │ │
│  │ [安装]                                 │ │
│  └────────────────────────────────────────┘ │
│                                              │
└──────────────────────────────────────────────┘
```

**验收标准**:
- 显示可用框架列表
- 显示已安装状态
- 可以一键安装
- 显示安装进度条

---

### **Phase 4: 插件管理（3-4天）**

#### 4.1 创建本地插件数据（0.5天）

**任务**:
- [ ] 创建 `plugins-manifest.json` 模板
- [ ] 添加5-10个常用插件数据
- [ ] 实现 `PluginRepositoryService.cs`

**文件清单**:
```
CSP2.Desktop/Data/
  └── plugins-manifest.json

CSP2.Core/Services/
  └── PluginRepositoryService.cs
```

**插件数据示例**:
```json
{
  "plugins": [
    {
      "id": "weaponpaints",
      "name": "WeaponPaints",
      "author": "Nereziel",
      "description": "武器皮肤插件",
      "framework": "counterstrikesharp",
      "version": "1.5.0",
      "downloadUrl": "https://github.com/.../releases/download/...",
      "category": "gameplay"
    }
  ]
}
```

---

#### 4.2 实现插件市场UI（1.5天）

**任务**:
- [ ] 创建PluginMarketPage视图
- [ ] 创建PluginMarketViewModel
- [ ] 实现插件列表展示
- [ ] 实现分类筛选
- [ ] 实现搜索功能

**文件清单**:
```
CSP2.Desktop/Pages/
  └── PluginMarketPage.xaml

CSP2.Desktop/ViewModels/
  └── PluginMarketViewModel.cs

CSP2.Desktop/Controls/
  └── PluginCard.xaml
```

**界面设计**:
```
┌──────────────────────────────────────────────┐
│  插件市场                                     │
├──────────────────────────────────────────────┤
│  [搜索插件...]           [分类: 全部 ▼]       │
│                                              │
│  ┌──────────────┐  ┌──────────────┐         │
│  │ WeaponPaints │  │ MatchZy      │         │
│  │ ★★★★☆        │  │ ★★★★★        │         │
│  │ 武器皮肤插件  │  │ 比赛管理     │         │
│  │              │  │              │         │
│  │ [安装]       │  │ [✓ 已安装]   │         │
│  └──────────────┘  └──────────────┘         │
│                                              │
│  ┌──────────────┐  ┌──────────────┐         │
│  │ OpenPrefirePrac│ │ AdminSystem  │         │
│  │ ★★★★☆        │  │ ★★★☆☆        │         │
│  │ 预瞄练习     │  │ 管理员系统   │         │
│  │              │  │              │         │
│  │ [安装]       │  │ [安装]       │         │
│  └──────────────┘  └──────────────┘         │
│                                              │
└──────────────────────────────────────────────┘
```

**验收标准**:
- 显示插件列表（卡片式）
- 可以按分类筛选
- 可以搜索插件
- 显示已安装标记

---

#### 4.3 实现插件安装功能（1天）

**任务**:
- [ ] 实现PluginManager.InstallPluginAsync
- [ ] 实现下载进度显示
- [ ] 实现依赖检查
- [ ] 实现错误处理

**验收标准**:
- 点击安装按钮可以下载插件
- 显示下载进度
- 自动解压到正确目录
- 安装完成后更新UI状态

---

#### 4.4 实现插件管理功能（1天）

**任务**:
- [ ] 实现"已安装插件"页面
- [ ] 实现插件启用/禁用
- [ ] 实现插件卸载
- [ ] 实现插件更新检查

**界面设计**:
```
┌──────────────────────────────────────────────┐
│  已安装插件 - 我的CS2服务器                    │
├──────────────────────────────────────────────┤
│  [检查更新]                                   │
│                                              │
│  ┌────────────────────────────────────────┐ │
│  │ ✓ WeaponPaints            v1.5.0       │ │
│  │   框架: CounterStrikeSharp              │ │
│  │   状态: ✓ 已启用                        │ │
│  │                                        │ │
│  │   [禁用] [卸载] [配置]                 │ │
│  └────────────────────────────────────────┘ │
│                                              │
│  ┌────────────────────────────────────────┐ │
│  │ ○ MatchZy                 v0.8.0       │ │
│  │   框架: CounterStrikeSharp              │ │
│  │   状态: ○ 已禁用                        │ │
│  │                                        │ │
│  │   [启用] [卸载] [配置]                 │ │
│  └────────────────────────────────────────┘ │
│                                              │
└──────────────────────────────────────────────┘
```

**验收标准**:
- 显示已安装插件列表
- 可以启用/禁用插件
- 可以卸载插件
- 可以检查更新

---

### **Phase 5: SteamCMD集成（可选，2-3天）**

> 这个阶段可以放到V2，因为用户可以使用已有的CS2安装

#### 5.1 实现SteamCmdService（1.5天）

**任务**:
- [ ] 实现SteamCMD下载
- [ ] 实现CS2服务器下载
- [ ] 实现进度报告

---

#### 5.2 UI集成（1天）

**任务**:
- [ ] 添加"下载服务器"向导
- [ ] 显示下载进度

---

### **Phase 6: 测试和优化（2-3天）**

#### 6.1 功能测试（1天）

**任务**:
- [ ] 完整流程测试（添加服务器→安装框架→安装插件→启动服务器）
- [ ] 边界条件测试
- [ ] 错误处理测试
- [ ] 性能测试

---

#### 6.2 UI优化（1天）

**任务**:
- [ ] 美化界面样式
- [ ] 添加动画效果
- [ ] 优化布局
- [ ] 添加图标

---

#### 6.3 文档完善（1天）

**任务**:
- [ ] 编写用户手册
- [ ] 编写开发者文档
- [ ] 录制使用视频
- [ ] 编写README

---

### **Phase 7: 发布（1天）**

#### 7.1 准备发布

**任务**:
- [ ] 编译Release版本
- [ ] 创建安装包（可选）
- [ ] 编写CHANGELOG
- [ ] 创建GitHub Release
- [ ] 发布到社区

---

## 📊 时间估算

| 阶段 | 工作量 | 累计 |
|------|--------|------|
| Phase 0: 项目初始化 | 1-2天 | 2天 |
| Phase 1: 核心架构 | 3-4天 | 6天 |
| Phase 2: 基础UI | 3-4天 | 10天 |
| Phase 3: 框架管理 | 2-3天 | 13天 |
| Phase 4: 插件管理 | 3-4天 | 17天 |
| Phase 5: SteamCMD（可选） | 2-3天 | 20天 |
| Phase 6: 测试优化 | 2-3天 | 23天 |
| Phase 7: 发布 | 1天 | 24天 |

**总计**: 约3-4周（如果跳过Phase 5，约2-3周）

---

## 🎯 里程碑

### **Milestone 1: 核心可用（10天）**
- ✅ 可以添加服务器
- ✅ 可以启动/停止服务器
- ✅ 可以查看日志
- ✅ 可以发送命令

### **Milestone 2: 框架管理（13天）**
- ✅ 可以安装Metamod
- ✅ 可以安装CounterStrikeSharp

### **Milestone 3: 插件管理（17天）**
- ✅ 可以浏览插件市场
- ✅ 可以安装/卸载插件
- ✅ 可以管理已安装插件

### **Milestone 4: MVP完成（24天）**
- ✅ 所有核心功能完成
- ✅ 测试通过
- ✅ 文档完善
- ✅ 发布第一个版本

---

## 📝 每日任务示例

### **第1天 - 项目初始化**
- [ ] 上午：阅读完所有文档
- [ ] 上午：创建GitHub仓库
- [ ] 下午：创建Visual Studio解决方案
- [ ] 下午：创建项目结构
- [ ] 晚上：验证编译通过

### **第2天 - 核心接口**
- [ ] 上午：创建所有接口定义
- [ ] 下午：创建数据模型
- [ ] 晚上：添加XML注释

### **第3天 - Provider机制**
- [ ] 上午：实现ProviderRegistry
- [ ] 下午：实现依赖注入
- [ ] 晚上：编写单元测试

---

## 🤝 协作方式

**如果是团队开发**:
- 每天同步进度
- 使用Git分支开发
- Code Review
- 每周发布测试版本

**如果是个人开发**:
- 按照路线图顺序执行
- 每完成一个阶段提交代码
- 记录遇到的问题
- 定期备份代码

---

## ✅ 最新更新 (2025-10-25)

### Debug模式和日志系统增强

**已完成特性**:

1. **Debug启动配置**
   - [x] 创建 `.vscode/launch.json` - 支持Debug模式启动
   - [x] 创建 `.vscode/tasks.json` - 自动化构建任务
   - [x] 命令行参数 `--debug` 支持
   - [x] 环境变量 `CSP2_DEBUG` 支持

2. **Debug控制台**
   - [x] 创建 `DebugConsoleViewModel` - 应用级日志管理
   - [x] 创建 `DebugConsolePage` - Debug日志UI
   - [x] 实现 `DebugLogger` - 全局日志记录器
   - [x] 侧栏菜单项（仅Debug模式显示）
   - [x] 日志过滤（Debug/Info/Warning/Error）
   - [x] 日志导出功能

3. **详细日志输出**
   - [x] `ServerManagementViewModel` - 添加Debug日志
   - [x] `SteamCmdService` - 添加Debug日志
   - [x] `ServerManager` - 添加Debug日志
   - [x] 所有关键操作点添加日志输出

4. **UI卡死问题修复**
   - [x] 修复 `ZipFile.ExtractToDirectory` 同步阻塞
   - [x] 修复 `Dispatcher.Invoke` 导致的阻塞
   - [x] 修复 `MessageBox.Show` 在异步方法中的使用
   - [x] 优化所有Progress回调使用 `BeginInvoke`
   - [x] 避免死锁的 `GetAwaiter().GetResult()` 调用

**文档更新**:
- [x] 技术设计文档 - 添加"调试和日志系统"章节
- [x] 技术设计文档 - 添加"UI线程管理"最佳实践
- [x] 开发路线图 - 记录最新完成的特性

**使用方式**:
```bash
# 方式1: 命令行启动Debug模式
CSP2.Desktop.exe --debug

# 方式2: VS Code调试
# 按F5，选择 "CSP2 Desktop (Debug Mode)"

# 方式3: 环境变量
# 设置 CSP2_DEBUG=true 然后运行程序
```

**Debug模式特点**:
- 自动启用Debug级别的Serilog日志
- 侧栏显示 "🐛 Debug控制台" 菜单项
- 实时查看应用程序内部操作
- 支持按类别和级别过滤日志
- 支持导出日志到桌面

**双日志系统**:
1. **Debug控制台** - 应用程序本身的日志
2. **日志控制台** - CS2服务器进程的输出

---

## 🔄 V2规划（MVP之后）

### **V2.1 跨平台支持**
- [ ] 迁移到Avalonia UI
- [ ] 实现LinuxPlatformProvider
- [ ] Linux环境测试

### **V2.2 插件生态**
- [ ] 创建独立插件仓库
- [ ] 实现GitHub Actions自动更新
- [ ] 实现插件评分系统
- [ ] 社区贡献指南

### **V2.3 更多框架**
- [ ] Swiftly框架支持
- [ ] SourceMod框架支持
- [ ] 社区提供的其他框架

### **V2.4 高级功能**
- [ ] RCON远程控制
- [ ] 自动备份
- [ ] 性能监控
- [ ] 多服务器批量操作
- [ ] 插件开发脚手架

---

## 📚 下一步

1. **如果您是新手**: 先阅读 `04-WPF快速入门.md` 学习基础知识
2. **如果您准备开始**: 执行Phase 0的任务，创建项目结构
3. **如果您有疑问**: 随时询问！

---

**文档结束**

