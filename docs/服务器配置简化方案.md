# CSP2 服务器配置简化方案

> 参考 cs2servergui 的设计理念，简化配置流程，给用户更多自由度

**日期**: 2025-10-26  
**状态**: 设计中

---

## 📋 当前问题

### 1. 过度封装
- 将所有 CS2 启动参数都封装成 UI 选项
- 用户想用原生参数反而不知道怎么配置

### 2. 配置太强制
- 很多选项是可选的，但 UI 上强制要填
- 用户没有足够的自由度

### 3. 界面复杂
- 多个 Tab 页，新手不知道该配置什么
- 高级用户觉得麻烦，还不如直接写启动参数

### 4. 缺少 autoexec 支持
- 服务器名称、密码等应该通过 autoexec.cfg 配置
- 不应该都作为启动参数

---

## ✅ 改进方案

### 核心理念

> **最小干预，最大自由**

1. **只提供核心配置的 UI** - 端口、地图、玩家数等必填项
2. **自定义参数框** - 允许用户直接输入任何启动参数
3. **autoexec 支持** - 引导用户使用 autoexec.cfg 配置高级选项
4. **单一简洁界面** - 去掉多余 Tab，一个页面搞定

---

## 🎯 新配置界面设计

### 第一部分：核心配置（必填）

```
┌─────────────────────────────────────────┐
│ ⚙️ 服务器配置                            │
├─────────────────────────────────────────┤
│                                         │
│ 基本设置                                 │
│                                         │
│ 端口:        [27015]                    │
│ 地图:        [de_dust2  ▼]              │
│ 最大玩家:    [10]                       │
│ 游戏模式:    [竞技模式   ▼]              │
│                                         │
└─────────────────────────────────────────┘
```

### 第二部分：常用选项（可选）

```
┌─────────────────────────────────────────┐
│ 常用选项                                 │
│                                         │
│ ☐ 禁用 BOT                              │
│ ☐ Insecure 模式（用于自定义地图）         │
│ ☐ 局域网模式                            │
│                                         │
│ TickRate:    [128  ▼]                  │
│                                         │
└─────────────────────────────────────────┘
```

### 第三部分：自定义参数（高级）

```
┌─────────────────────────────────────────┐
│ 自定义参数                               │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ -high +sv_cheats 1 +mp_warmup_end   │ │
│ │ +exec custom.cfg                    │ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 💡 提示：                                │
│ • 可以添加任何启动参数                   │
│ • 每个参数用空格分隔                     │
│ • 使用 +exec 执行自定义配置文件          │
│                                         │
└─────────────────────────────────────────┘
```

### 第四部分：高级配置引导

```
┌─────────────────────────────────────────┐
│ 💡 配置服务器名称和密码                   │
│                                         │
│ 1. 创建 autoexec.cfg 文件               │
│    路径: game/csgo/cfg/autoexec.cfg    │
│                                         │
│ 2. 添加以下内容:                        │
│    hostname "我的服务器"                 │
│    sv_password "密码"                   │
│    rcon_password "rcon密码"            │
│                                         │
│ [📝 生成 autoexec]  [📁 打开配置目录]   │
│                                         │
└─────────────────────────────────────────┘
```

---

## 🔧 新的 ServerConfig 模型

### 简化版配置类

```csharp
public class ServerConfig
{
    // ============ 核心配置（必填）============
    
    /// <summary>
    /// 服务器端口
    /// </summary>
    public int Port { get; set; } = 27015;
    
    /// <summary>
    /// 启动地图
    /// </summary>
    public string Map { get; set; } = "de_dust2";
    
    /// <summary>
    /// 最大玩家数 (1-64)
    /// </summary>
    public int MaxPlayers { get; set; } = 10;
    
    /// <summary>
    /// 游戏模式 (0=休闲, 1=竞技, 2=翼人, 3=武器大师)
    /// </summary>
    public int GameMode { get; set; } = 1;
    
    /// <summary>
    /// 游戏类型 (0=经典, 1=军备竞赛, 2=死亡竞赛)
    /// </summary>
    public int GameType { get; set; } = 0;
    
    // ============ 常用选项（可选）============
    
    /// <summary>
    /// Tick速率 (64或128)
    /// </summary>
    public int TickRate { get; set; } = 128;
    
    /// <summary>
    /// 禁用 BOT
    /// </summary>
    public bool DisableBots { get; set; } = false;
    
    /// <summary>
    /// Insecure 模式（用于自定义地图）
    /// </summary>
    public bool InsecureMode { get; set; } = false;
    
    /// <summary>
    /// 局域网模式
    /// </summary>
    public bool IsLanMode { get; set; } = false;
    
    // ============ 自定义参数 ============
    
    /// <summary>
    /// 自定义启动参数（原始字符串）
    /// 例如: "-high +sv_cheats 1 +exec custom.cfg"
    /// </summary>
    public string CustomParameters { get; set; } = string.Empty;
    
    // ============ 服务器路径信息（内部使用）============
    
    /// <summary>
    /// IP地址（固定为 0.0.0.0，不暴露给用户）
    /// </summary>
    [JsonIgnore]
    public string IpAddress => "0.0.0.0";
    
    /// <summary>
    /// 地图组（自动推断，不暴露给用户）
    /// </summary>
    [JsonIgnore]
    public string MapGroup => "mg_active";
}
```

---

## 🚀 启动参数构建逻辑

### 简化的参数构建

```csharp
private string BuildStartupArguments(ServerConfig config)
{
    var args = new List<string>
    {
        // 核心必需参数
        "-dedicated",
        "-norestart",
        $"-port {config.Port}",
        $"+map {config.Map}",
        $"-maxplayers {config.MaxPlayers}",
        $"-tickrate {config.TickRate}",
        $"+game_type {config.GameType}",
        $"+game_mode {config.GameMode}",
        "+mapgroup mg_active"
    };
    
    // 可选参数
    if (config.DisableBots)
    {
        args.Add("+bot_quota 0");
    }
    
    if (config.InsecureMode)
    {
        args.Add("-insecure");
    }
    
    if (config.IsLanMode)
    {
        args.Add("+sv_lan 1");
    }
    
    // 自定义参数（用户完全控制）
    if (!string.IsNullOrWhiteSpace(config.CustomParameters))
    {
        args.Add(config.CustomParameters.Trim());
    }
    
    return string.Join(" ", args);
}
```

---

## 📝 迁移计划

### Phase 1: 新建简化配置组件
- [ ] 创建 `SimpleServerConfigDialog.xaml`
- [ ] 实现自定义参数输入框
- [ ] 添加 autoexec 生成器功能

### Phase 2: 向后兼容
- [ ] 保留旧的 `ServerConfig` 类
- [ ] 添加配置迁移逻辑
- [ ] 旧配置自动转换为新格式

### Phase 3: 测试和优化
- [ ] 测试各种参数组合
- [ ] 收集用户反馈
- [ ] 完善文档

---

## 💡 用户体验改进

### 对新手友好
- **默认配置即可用** - 只需填端口和地图就能启动
- **简洁的界面** - 不会被一堆选项吓到
- **引导式提示** - 告诉用户如何配置高级选项

### 对高级用户友好
- **自定义参数框** - 可以直接写任何启动参数
- **不限制功能** - 通过自定义参数可以用CS2的任何功能
- **autoexec 支持** - 按照CS2官方方式配置服务器

---

## 📊 对比

| 特性 | 当前CSP2 | 新设计 | cs2servergui |
|------|----------|--------|--------------|
| 配置项数量 | 20+ | 10 | 12 |
| Tab 页数 | 4 | 1 | 1 |
| 自定义参数 | ❌ | ✅ | ✅ |
| autoexec 支持 | ❌ | ✅ | ✅ |
| 学习曲线 | 陡峭 | 平缓 | 平缓 |
| 灵活性 | 低 | 高 | 高 |

---

## 🎯 总结

### 设计原则

1. **最小必需配置** - 只暴露真正必要的选项
2. **最大自由度** - 通过自定义参数支持所有功能
3. **遵循官方惯例** - 使用 autoexec.cfg 等标准做法
4. **降低学习成本** - 界面简洁，一目了然

### 核心改变

- ❌ 去掉：性能优化Tab、高级选项Tab、日志选项Tab
- ✅ 保留：端口、地图、玩家数、游戏模式
- ✅ 新增：自定义参数文本框
- ✅ 新增：autoexec 生成器

---

**下一步**: 实现新的简化配置界面

