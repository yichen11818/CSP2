# CSP2 项目结构说明

> 详细说明项目的目录组织和文件结构

**更新时间**: 2025-10-25

---

## 📁 完整目录结构

```
csp2/
├── src/                                    # 源代码目录
│   ├── CSP2.Core/                          # 核心库（不依赖UI）
│   │   ├── Abstractions/                   # 抽象接口
│   │   │   ├── IPlatformProvider.cs
│   │   │   ├── IFrameworkProvider.cs
│   │   │   ├── IExtensionProvider.cs
│   │   │   ├── IServerManager.cs
│   │   │   ├── IPluginManager.cs
│   │   │   ├── ISteamCmdService.cs
│   │   │   └── IPluginRepositoryService.cs
│   │   │
│   │   ├── Models/                         # 数据模型
│   │   │   ├── Server.cs
│   │   │   ├── ServerConfig.cs
│   │   │   ├── PluginInfo.cs
│   │   │   ├── InstalledPlugin.cs
│   │   │   ├── FrameworkInfo.cs
│   │   │   ├── ProviderMetadata.cs
│   │   │   ├── InstallResult.cs
│   │   │   └── ProgressInfo.cs
│   │   │
│   │   ├── Services/                       # 核心服务实现
│   │   │   ├── ServerManager.cs
│   │   │   ├── PluginManager.cs
│   │   │   ├── ProviderRegistry.cs
│   │   │   ├── SteamCmdService.cs
│   │   │   ├── PluginRepositoryService.cs
│   │   │   └── ConfigurationService.cs
│   │   │
│   │   ├── Extensions/                     # 扩展方法
│   │   │   ├── StringExtensions.cs
│   │   │   └── ProcessExtensions.cs
│   │   │
│   │   ├── Utilities/                      # 工具类
│   │   │   ├── PathHelper.cs
│   │   │   ├── ProcessHelper.cs
│   │   │   └── DownloadHelper.cs
│   │   │
│   │   └── CSP2.Core.csproj
│   │
│   ├── CSP2.Providers/                     # 官方Provider实现
│   │   ├── Platforms/                      # 平台Provider
│   │   │   └── Windows/
│   │   │       ├── WindowsPlatformProvider.cs
│   │   │       ├── WindowsServerProcess.cs
│   │   │       └── WindowsSystemInfo.cs
│   │   │
│   │   ├── Frameworks/                     # 框架Provider
│   │   │   ├── CounterStrikeSharp/
│   │   │   │   ├── CSSFrameworkProvider.cs
│   │   │   │   ├── CSSPluginInstaller.cs
│   │   │   │   └── CSSConfigManager.cs
│   │   │   │
│   │   │   └── Metamod/
│   │   │       ├── MetamodFrameworkProvider.cs
│   │   │       └── MetamodInstaller.cs
│   │   │
│   │   └── CSP2.Providers.csproj
│   │
│   ├── CSP2.Desktop/                       # WPF桌面应用
│   │   ├── Views/                          # 视图（XAML + 代码后台）
│   │   │   ├── MainWindow.xaml
│   │   │   ├── MainWindow.xaml.cs
│   │   │   ├── Pages/
│   │   │   │   ├── ServerManagementPage.xaml
│   │   │   │   ├── PluginMarketPage.xaml
│   │   │   │   ├── LogConsolePage.xaml
│   │   │   │   └── SettingsPage.xaml
│   │   │   │
│   │   │   └── Dialogs/
│   │   │       ├── AddServerDialog.xaml
│   │   │       └── PluginDetailsDialog.xaml
│   │   │
│   │   ├── ViewModels/                     # 视图模型
│   │   │   ├── MainWindowViewModel.cs
│   │   │   ├── ServerManagementViewModel.cs
│   │   │   ├── PluginMarketViewModel.cs
│   │   │   ├── LogConsoleViewModel.cs
│   │   │   └── SettingsViewModel.cs
│   │   │
│   │   ├── Controls/                       # 自定义控件
│   │   │   ├── ServerCard.xaml
│   │   │   ├── PluginCard.xaml
│   │   │   └── LogViewer.xaml
│   │   │
│   │   ├── Converters/                     # 值转换器
│   │   │   ├── BoolToVisibilityConverter.cs
│   │   │   ├── StatusToColorConverter.cs
│   │   │   └── BytesToSizeConverter.cs
│   │   │
│   │   ├── Resources/                      # 资源文件
│   │   │   ├── Styles/
│   │   │   │   ├── ButtonStyles.xaml
│   │   │   │   ├── TextBoxStyles.xaml
│   │   │   │   └── Colors.xaml
│   │   │   │
│   │   │   ├── Images/
│   │   │   │   ├── logo.png
│   │   │   │   └── icons/
│   │   │   │
│   │   │   └── Fonts/
│   │   │
│   │   ├── App.xaml                        # 应用程序定义
│   │   ├── App.xaml.cs                     # 应用程序入口
│   │   └── CSP2.Desktop.csproj
│   │
│   └── CSP2.SDK/                           # 扩展开发SDK（可选）
│       ├── IExtensionProvider.cs
│       ├── ExtensionBase.cs
│       ├── ExtensionContext.cs
│       └── CSP2.SDK.csproj
│
├── tests/                                  # 单元测试
│   ├── CSP2.Core.Tests/
│   │   ├── Services/
│   │   │   ├── ServerManagerTests.cs
│   │   │   └── PluginManagerTests.cs
│   │   └── CSP2.Core.Tests.csproj
│   │
│   └── CSP2.Providers.Tests/
│       └── CSP2.Providers.Tests.csproj
│
├── docs/                                   # 文档
│   ├── 01-技术设计文档.md
│   ├── 02-项目结构说明.md
│   ├── 03-开发路线图.md
│   ├── 04-WPF快速入门.md
│   ├── 05-Provider开发指南.md
│   └── images/
│
├── data/                                   # 运行时数据（运行时生成）
│   ├── servers.json                        # 服务器列表
│   ├── plugins-cache.json                  # 插件缓存
│   └── settings.json                       # 用户设置
│
├── providers/                              # 第三方Provider（用户安装）
│   └── (第三方DLL文件)
│
├── .github/                                # GitHub配置
│   └── workflows/
│       ├── build.yml                       # 自动构建
│       └── release.yml                     # 自动发布
│
├── .gitignore
├── README.md                               # 项目说明
├── LICENSE                                 # MIT协议
└── CSP2.sln                                # Visual Studio解决方案文件
```

---

## 📦 项目说明

### **CSP2.Core** - 核心库

**作用**: 定义所有核心接口和实现，不依赖任何UI框架

**关键文件说明**:

| 文件 | 说明 |
|------|------|
| `Abstractions/IPlatformProvider.cs` | 平台抽象接口，定义启动服务器、管理进程等方法 |
| `Abstractions/IFrameworkProvider.cs` | 框架抽象接口，定义安装框架、管理插件等方法 |
| `Models/Server.cs` | 服务器实体类，包含ID、名称、路径、状态等 |
| `Services/ServerManager.cs` | 服务器管理核心实现 |
| `Services/ProviderRegistry.cs` | Provider注册中心 |

**依赖关系**:
```
CSP2.Core
  └── Microsoft.Extensions.DependencyInjection
  └── Microsoft.Extensions.Logging
  └── Serilog
```

---

### **CSP2.Providers** - 官方Provider实现

**作用**: 实现Windows平台支持、CSS和Metamod框架支持

**关键文件说明**:

| 文件 | 说明 |
|------|------|
| `Platforms/Windows/WindowsPlatformProvider.cs` | Windows平台实现，处理进程启动、端口检测等 |
| `Frameworks/CounterStrikeSharp/CSSFrameworkProvider.cs` | CSS框架实现，安装、更新、管理CSS插件 |
| `Frameworks/Metamod/MetamodFrameworkProvider.cs` | Metamod框架实现 |

**依赖关系**:
```
CSP2.Providers
  └── CSP2.Core (引用)
  └── System.IO.Compression (ZIP解压)
  └── HttpClient (下载)
```

---

### **CSP2.Desktop** - WPF桌面应用

**作用**: 用户界面，使用MVVM模式

**关键文件说明**:

| 文件 | 说明 |
|------|------|
| `App.xaml` | 应用程序入口，配置依赖注入、日志等 |
| `MainWindow.xaml` | 主窗口界面定义 |
| `ViewModels/MainWindowViewModel.cs` | 主窗口的ViewModel，处理导航和全局状态 |
| `Pages/ServerManagementPage.xaml` | 服务器管理页面 |
| `ViewModels/ServerManagementViewModel.cs` | 服务器管理ViewModel，绑定数据和命令 |

**MVVM结构**:
```
View (XAML)
  └── 绑定 (Binding)
      └── ViewModel
          └── 调用 (Calls)
              └── Service (Core)
```

**依赖关系**:
```
CSP2.Desktop
  └── CSP2.Core (引用)
  └── CSP2.Providers (引用)
  └── CommunityToolkit.Mvvm (MVVM辅助)
  └── WPF框架
```

---

## 🔧 关键配置文件

### **CSP2.Core.csproj**

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net8.0</TargetFramework>
    <LangVersion>12</LangVersion>
    <Nullable>enable</Nullable>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="8.0.0" />
    <PackageReference Include="Microsoft.Extensions.Logging" Version="8.0.0" />
    <PackageReference Include="Microsoft.Extensions.Configuration" Version="8.0.0" />
    <PackageReference Include="Serilog" Version="3.1.0" />
    <PackageReference Include="Polly" Version="8.0.0" />
  </ItemGroup>
</Project>
```

### **CSP2.Desktop.csproj**

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>WinExe</OutputType>
    <TargetFramework>net8.0-windows</TargetFramework>
    <UseWPF>true</UseWPF>
    <LangVersion>12</LangVersion>
    <Nullable>enable</Nullable>
    <ApplicationIcon>Resources\Images\logo.ico</ApplicationIcon>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\CSP2.Core\CSP2.Core.csproj" />
    <ProjectReference Include="..\CSP2.Providers\CSP2.Providers.csproj" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="CommunityToolkit.Mvvm" Version="8.2.0" />
    <PackageReference Include="Microsoft.Extensions.Hosting" Version="8.0.0" />
  </ItemGroup>
</Project>
```

---

## 📝 数据文件格式

### **servers.json** - 服务器配置

```json
{
  "version": "1.0",
  "servers": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "我的CS2服务器",
      "installPath": "C:\\Games\\CS2Server",
      "config": {
        "port": 27015,
        "map": "de_dust2",
        "maxPlayers": 10,
        "gameType": 0,
        "gameMode": 1,
        "tickRate": 128,
        "steamToken": "YOUR_TOKEN_HERE",
        "customArgs": {}
      },
      "frameworks": [
        {
          "id": "metamod",
          "version": "2.0.0"
        },
        {
          "id": "counterstrikesharp",
          "version": "1.0.0"
        }
      ],
      "createdAt": "2025-10-25T12:00:00Z",
      "lastStartedAt": "2025-10-25T14:30:00Z"
    }
  ]
}
```

### **settings.json** - 全局设置

```json
{
  "version": "1.0",
  "ui": {
    "theme": "dark",
    "language": "zh-CN",
    "autoCheckUpdates": true
  },
  "steamcmd": {
    "installPath": "C:\\CSP2\\steamcmd",
    "autoDownload": true
  },
  "pluginRepository": {
    "url": "https://raw.githubusercontent.com/username/csp2-plugins/main/manifest.json",
    "cacheExpiration": 3600
  }
}
```

---

## 🗂️ 文件命名规范

### **C#文件**
- 类文件：`PascalCase.cs`，如 `ServerManager.cs`
- 接口文件：`IPascalCase.cs`，如 `IServerManager.cs`
- 每个文件只包含一个公共类/接口

### **XAML文件**
- 窗口/页面：`PascalCase.xaml`，如 `MainWindow.xaml`
- 用户控件：`PascalCase.xaml`，如 `ServerCard.xaml`
- 资源字典：`PascalCase.xaml`，如 `ButtonStyles.xaml`

### **文档文件**
- Markdown文档：`编号-标题.md`，如 `01-技术设计文档.md`
- 全部使用中文文件名（因为面向中文用户）

---

## 🔗 项目引用关系

```
CSP2.Desktop
  ├── 引用 CSP2.Core
  └── 引用 CSP2.Providers
        └── 引用 CSP2.Core

CSP2.SDK
  └── 引用 CSP2.Core (仅接口)

第三方Provider.dll
  └── 引用 CSP2.Core (仅接口)
```

**依赖原则**:
- Core不依赖任何具体实现
- Providers依赖Core
- Desktop依赖Core和Providers
- 第三方Provider只依赖Core的接口

---

## 📂 运行时目录结构

```
C:\Program Files\CSP2\           # 安装目录
├── CSP2.Desktop.exe             # 主程序
├── CSP2.Core.dll
├── CSP2.Providers.dll
├── (其他依赖DLL)
│
├── data/                        # 数据目录（自动创建）
│   ├── servers.json
│   ├── settings.json
│   └── logs/                    # 日志文件
│       └── csp2-20251025.log
│
├── providers/                   # 第三方Provider
│   ├── LinuxProvider.dll
│   └── SwiftlyProvider.dll
│
└── Resources/                   # 资源文件
    └── Images/
```

---

## 🎯 下一步

阅读完本文档后，请查看：
- `03-开发路线图.md` - 了解具体开发计划和任务分解
- `04-WPF快速入门.md` - 学习WPF和MVVM基础

---

**文档结束**

